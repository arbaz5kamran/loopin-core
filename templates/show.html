{% extends 'base.html' %}
{% block title %}Updates â€“ {{ app_name }}{% endblock %}

{% block content %}
  <h2>All Updates</h2>
  <ul class="updates-list">
    {% for update in updates %}
      <li id="update-{{ update.id }}" class="update-item {% if update.is_new %}new-update{% endif %}" data-update-id="{{ update.id }}">
        <div class="update-header">
          <span class="author-info">
            {% if update.is_new %}
              <span class="new-dot">â€¢</span>
            {% endif %}
            <strong class="author">{{ update.name }}</strong>
            <span class="process"> â€” Process: <strong>{{ update.process }}</strong></span>
            (<span class="timestamp">{{ update.timestamp }}</span>)
          </span>
          <span class="read-count">ðŸ“– {{ update.read_count }} reads</span>

          {% if current_user and update.name and current_user.display_name and current_user.display_name|lower == update.name|lower %}
            <div class="actions">
              <a href="{{ url_for('edit_update', update_id=update.id) }}" class="button small edit-btn">Edit</a>
              <form action="{{ url_for('delete_update', update_id=update.id) }}" method="POST" class="inline-form">
                <button type="submit" class="button small delete-btn">Delete</button>
              </form>
            </div>
          {% endif %}
        </div>
        <p class="message">{{ update.message }}</p>
      </li>
    {% else %}
      <li class="update-item">No updates yet. Be the first to post!</li>
    {% endfor %}
  </ul>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const hash = window.location.hash;
  if (hash && hash.startsWith('#update-')) {
    const el = document.querySelector(hash);
    if (el) {
      el.classList.add('search-highlight');
      setTimeout(() => {
        el.classList.remove('search-highlight');
      }, 1200);
      el.scrollIntoView({behavior: 'smooth', block: 'center'});
    }
  }
});
</script>
<style>
.update-item.search-highlight {
  animation: blink-highlight 1.2s linear 1;
  background: #fffbe6 !important;
}
@keyframes blink-highlight {
  0% { background: #fffbe6; }
  30% { background: #ffe066; }
  60% { background: #fffbe6; }
  100% { background: inherit; }
}
</style>
{% endblock %}
